// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id      String   @id @default(uuid())
  email   String   @unique
  first_name String
  last_name  String
  password String
  position String?
  username String 
  role String?
  team String? //TODO: create a separate team model
  location String?
  phone String?
  tokens RefreshToken[]
  projects Project[]
  comments Comment[]

  assignedTasks  Task[]  @relation("assignedTasks")   
  tasksCreated   Task[]  @relation("tasksCreated")    
  tasksUpdated   Task[]  @relation("tasksUpdated") 
  attachments Attachment[]

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @default(now()) @map("updated_at")
}
model RefreshToken {
  id      String   @id @default(uuid())
  token   String   @unique
  expiresAt DateTime @map("expires_at")
  createdAt DateTime @default(now()) @map("created_at")
  user User @relation(fields: [userId], references: [id])
  userId String @map("user_id")
}


model Project{
  id String @id @default(uuid())
  name String
  slug String?
  description String?
  view View @default(table)
  tasks Task[] @relation("projectToTasks")

  createdBy User @relation(fields: [createdById], references: [id]) 
  createdById String @map("created_by")
  createdAt DateTime @default(now()) @map("created_at")
}
enum View {
  table
  board
}
model Comment {
  id String @id @default(uuid())
  content String
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @default(now()) @map("updated_at")

  parent Comment? @relation("CommentToReplies",fields: [parentId], references: [id])
  parentId String? @map("parent_id")
  replies    Comment[] @relation("CommentToReplies")
  task Task? @relation("taskToComments", fields: [taskId], references: [id])
  taskId String @map("task_id")

  createdBy User @relation(fields: [createdById], references: [id])
  createdById String @map("created_by")
}

model Task{
  id String @id @default(uuid())
  title String
  description String?
  
  project Project @relation("projectToTasks",fields: [projectId], references: [id])
  projectId String @map("project_id")

  assignedUser User? @relation("assignedTasks",fields: [assignedUserId], references: [id])
  assignedUserId String? @map("assigned_user")

 status Status @relation("taskStatus", fields: [statusId], references: [id])
  statusId String
  type String

  priority Status? @relation("taskPriority", fields: [priorityId], references: [id])
  priorityId String?
  estimation String?
  slug String
  dueDate DateTime? @map("due_date")
  
  comments Comment[] @relation("taskToComments")
  attachments Attachment[] @relation("taskToAttachments")

  relatedTo   Task?     @relation("TaskRelations", fields: [relatedToId], references: [id])
  relatedToId String?   @map("related_to")
  relatedTasks Task[]   @relation("TaskRelations")
  
  createdBy User @relation("tasksCreated",fields: [createdById], references: [id])
  createdById String @map("created_by")
  updatedBy User @relation("tasksUpdated",fields: [updatedById], references: [id])
  updatedById String @map("updated_by")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @default(now()) @map("updated_at")
}

model Attachment{
  id String @id @default(uuid())
  name String
  url String
  type String
  size Int

  task Task @relation("taskToAttachments",fields: [taskId], references: [id])
  taskId String @map("task_id")

  createdBy User @relation(fields: [createdById], references: [id])
  createdById String @map("created_by")
  createdAt DateTime @default(now()) @map("created_at")
}

model Status{
  id String @id @default(uuid())
  label String
  color String
  orderIndex Int @map("order_index")

 tasksWithPriority Task[] @relation("taskPriority")
tasksWithStatus Task[] @relation("taskStatus")
}